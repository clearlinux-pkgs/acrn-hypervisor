From b24b9cb310a4add944fcaf2bde8e78f5d1ebbe00 Mon Sep 17 00:00:00 2001
From: Tw <wei.tan@intel.com>
Date: Thu, 24 Jan 2019 13:54:49 +0800
Subject: [PATCH] Makefile: add missing dependency

There is a missing dependency between lib and bin in Makefile.
BTW, this issue is triggered by concurrent build.

Tracked-On: #2370
Signed-off-by: Tw <wei.tan@intel.com>
Reviewed-by: Binbin Wu <binbin.wu@intel.com>
---
 hypervisor/Makefile | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/hypervisor/Makefile b/hypervisor/Makefile
index 6eabf94af..8db29c726 100644
--- a/hypervisor/Makefile
+++ b/hypervisor/Makefile
@@ -336,7 +336,9 @@ $(HV_OBJDIR)/$(HV_FILE).bin: $(HV_OBJDIR)/$(HV_FILE).out
 
 $(HV_OBJDIR)/$(HV_FILE).out: $(C_OBJS) $(S_OBJS) $(LIB_FLAGS)
 	${BASH} ${LD_IN_TOOL} $(ARCH_LDSCRIPT_IN) $(ARCH_LDSCRIPT) ${HV_OBJDIR}/.config
-	$(CC) -Wl,-Map=$(HV_OBJDIR)/$(HV_FILE).map -o $@ $(LDFLAGS) $(ARCH_LDFLAGS) -T$(ARCH_LDSCRIPT) $^ $(LIB_FLAGS)
+	$(CC) -Wl,-Map=$(HV_OBJDIR)/$(HV_FILE).map -o $@ $(LDFLAGS) $(ARCH_LDFLAGS) -T$(ARCH_LDSCRIPT) $^
+
+$(LIB_FLAGS): lib
 
 .PHONY: clean
 clean:
